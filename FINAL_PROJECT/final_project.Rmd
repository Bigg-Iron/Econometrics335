---
title: "Final Project"
author: "Lorenzo Bartolo"

output:
  pdf_document: default
  html_document: default
    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(tidy.opts = list(width.cutoff = 60), tidy = TRUE, echo = TRUE)

# List of packages you want to install -- separated with a comma and surrounded in "quotes" 
packages <- c("tidyverse", "dplyr", "moments", "lmtest", "sandwich", "stringr", "readr", "here", "ggplot2", "modelr", "MASS", "knitr", "formatR", "car", "AER", "plm", "stargazer", "readxl","haven")

# Installs packages
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Loads packages
invisible(lapply(packages, library, character.only = TRUE))

# Load in Data
data_table_16 <- read_csv("../Data/health_ineq_online_table_16.csv")


```


*NOTE: The data is from "The Health Inequality Project", because the data is not publicly available. Income data for the US population were obtained from 1.4 billion deidentified tax records between 1999 and 2014. Mortality data were obtained from Social Security Administration death records. These data were used to estimate race- and ethnicity-adjusted life expectancy at 40 years of age by household income percentile, sex, and geographic area, and to evaluate factors associated with differences in life expectancy. *

*NOTE: I don't have access to the raw data, instead I am using the deidentified tax records and mortality data obtained from the "Health Inequality Project". Table 16 is National mortality rates by gender, age, year, and individual income percentile.*



# 1. Introduction and Statement of Research Question
- Pose and motivate the question to be investigated with your data and econometric model.
The relationship between income and health outcomes are well established. However, I wanted to investigate the relationship between an individual's income and their life expectancy. To put simply, does income effect how long you live?


# 2. Formulation of the Model
- Express the question both verbally and in the form of an equation to be estimated. Be sure to include the names and units of the dependent and independent variables.
- You must include at least three independent variables, but can include as many as you’d like
beyond that.
- Explain the mechanisms you believe pertain to your study question and why you selected the
particular X variables that you did and why you didn’t select others.
- You may also want to briefly cite relevant literature (e.g. previous studies) that you come across while researching your topic.

    I hypothesize that individual income has a significant effect on mortality and life expectancy. The United State's lack of basic social programs, and the privatization of healthcare, simply equates to health outcomes in proportion to an individual's income. Under the classical assumptions of economics, the market for healthcare services would behave identically to any other market, i.e. the market for an automobile; the vehicles with better features, airbags, seatbelts, cupholders, etc., will inherently cost more, and only the individual's who can afford these features will purchase the automobile. This often implies that those with higher incomes can afford vehicles with more advanced safety systems, reducing their chances of being injured or dying in a car crash. I hypothesize that these same market mechanisms apply to healthcare, and are pronounced due to the nature of services being sought. Individual's at the lower end of the income distribution are not able to afford the same healthcare services that the top income earners can afford. It is well established that access to better healthcare improves individual health outcomes and life expectancy. Therefore, it is reasonable to assume that those who do not have access to quality healthcare will have poorer health outcomes and a shorter life expectancy. 
    
    I test the hypothesis that individual income is a statistically significant indicator on life expectancy and mortality rate. In the model I have included individual income (indv_inc), individual income percentile (indv_pctile), while holding gender (gnd) constant.


## Individual Income and Mortality Rate Model
$$ \widehat{MortalityRate_{it}} =   \underset{(2.5722e-5)}{6.362022e-03} - \underset{(2.0868e-10)}{6.752e-09} \times indv\_inc_{it} + u_{it} $$
```{r}
sink(file = "indiv_Income_Mortality_Model.txt", append = FALSE)

# Individual Income and Mortality Rate Model
indiv_Income_Mortality_Model <- lm(data_table_16$mortrate ~ data_table_16$indv_inc)
cat("Individual Income and Mortality Rate Model: \n ")
summary(indiv_Income_Mortality_Model)
coeftest(indiv_Income_Mortality_Model, vcov. = vcovHC, type = "HC1")

sink()
```



## Individual Income and Life Expectancy Model
$$ \widehat{LifeExpectancy_{it}} =   \underset{(0.03481)}{54.966} + \underset{(2.43e-07)}{8.3513e-07} \times indv\_inc_{it} + u_{it} $$
```{r}
sink(file = "indiv_Income_Age_at_Death_Model.txt", append = FALSE)

# Individual Income and Age at Death Model
indiv_Income_Age_at_Death_Model <- lm(data_table_16$age_at_d ~ data_table_16$indv_inc)
cat("Individual Income and Age at Death Model:")
cat("\n ---------------------------------------------------------------")
summary(indiv_Income_Age_at_Death_Model)
coeftest(indiv_Income_Age_at_Death_Model, vcov. = vcovHC, type = "HC1")

sink()
```




## Individual Income Percentile and mortality rate Model
$$ \widehat{MortalityRate_{it}} =   \underset{(4.058e-05)}{9.993e-03} - \underset{(7.5419e-07)}{7.990e-05} \times indv\_pctile_{it} + u_{it} $$
```{r}
sink(file = "indiv_Income_pctile_Mortality_Model.txt", append = FALSE)

# Individual Income Percentile and Mortality Rate Model
indiv_Income_pctile_Mortality_Model <- lm(data_table_16$mortrate ~ data_table_16$indv_pctile)
cat("Individual Income Percentile and Mortality Rate Model: \n ")
summary(indiv_Income_pctile_Mortality_Model)
coeftest(indiv_Income_pctile_Mortality_Model, vcov. = vcovHC, type = "HC1")


sink()
```



## Individual Income Percentile and Life Expectancy Model
$$ \widehat{LifeExpectancy_{it}} =   \underset{(6.3758e-02)}{5.5016e+01} - \underset{(1.0961e-03)}{5.9910e-16} \times indv\_pctile_{it} + u_{it} $$
```{r}
sink(file = "indiv_IncomePercentile_LifeExpectancy_Model.txt", append = FALSE)

# Individual Income Percentile and Life Expectancy Model
indiv_IncomePercentile_LifeExpectancy_Model <- lm(data_table_16$age_at_d ~ data_table_16$indv_pctile)
cat("Individual Income Percentile and Age at Death Model:")
cat("\n ---------------------------------------------------------------")
summary(indiv_IncomePercentile_LifeExpectancy_Model)
coeftest(indiv_IncomePercentile_LifeExpectancy_Model, vcov. = vcovHC, type = "HC1")

sink()
```



# 3. Data Description
- Describe the data used to estimate the model. Your data set must have at least 40 observations.
- You should construct a table that provides the mean, minimum, maximum and standard deviation (and any other summary statistics you feel are relevant) of all variables in the model.
- You might also want to show and discuss key scatterplots or graphs of interest.
    The data used was deidentified data from federal income tax records from 1999 to 2014. The measure of income was pretax earnings. Mortality and death rates were attained from the Social Security Administration (SSA). There are several limitations to the data: while I would have liked to include more variables in the regression models, such as race or ethnicity, but race and ethnicity are not recorded in tax records. The other limitation within the data is that the data is not made available to the public, so I had to derive the data from a 2016 JAMA study: "The Association Between Income and Life Expectancy in the United States, 2001-2014".

- Describe the content of the summary statistics or table(s)
*NOTE: [INSERT SUMMARY STATISTICS HERE]*
```{r}
summary(data_table_16)

```




# 4. Empirical Results
- Present the results of the OLS estimation (and/or other appropriate technique learned in class) in
the form of a table(s).
*NOTE: [INSERT STARGAZER TABLE RESULTS]*

```{r}
# STARGAZER TABLE
stargazer(indiv_Income_Mortality_Model, indiv_Income_Age_at_Death_Model, indiv_Income_pctile_Mortality_Model, indiv_IncomePercentile_LifeExpectancy_Model, 
          digits = 3,
          header = FALSE,
          se = clustered_standard_errors,
          type = "latex", 
          title = "Linear Panel Regression Models of Income and Life Expectancy",
          model.numbers = FALSE,
          out="stargazer_table.txt")
```


- Tables should be formatted as easy-to-read tables rather than cut and pasted out of RStudio.

- You may want to, for example, examine your key parameter estimates with and without additional regressors to compare any differences (i.e., run a single regressor model and then a multiple regression model).

- You should show at least three specifications of your design.

- These will likely include various non-linear versions of a baseline model, for example by adding a polynomial or interaction variable, or by creating relevant categorical or binary variables to analyze group effects.

- Explain the meaning of estimated coefficients in your model and whether or not coefficients are statistically significant and at what level.

- Also discuss the goodness of fit measure for the model (e.g. R-squared, SER, adjusted R-squared).




# 5. Summary and Discussion
- Summarize your main results and discuss limitations to your approach.

- Carefully explain caveats to your study, especially whether or not certain parameter

estimates may be biased.
- Suggest what other independent variables, possible functional forms, or statistical tests
might be appropriate to include and any interesting follow-up questions or extensions
that may have come to mind.

- Address all issues of internal and external validity.



## Bibliography
All cited sources should be reported in a bibliography in MLA format.
o One useful reference is your textbook.
Also include anything relevant that is not within the main document at the end, such as
attachments of key R output (Here I want regression or summary statistics outputs, and not a
series of lines of code)
- 2016 JAMA Study: https://jamanetwork.com/journals/jama/fullarticle/2513561?guestAccessKey=4023ce75-d0fb-44de-bb6c-8a10a30a6173



## Formatting:
- Your report must be typed and proofread.
- There is no set minimum length of your paper as long as you cover all of the requirements.
- However, your paper should not exceed five(5) double spaced pages with 12-point font and
one-inch margins.
- This five-page maximum does not include attachments, graphs, tables etc.
- Projects are to be turned in via Canvas and must be completed individually.
- Your paper should be only your own work and not that of any other person.

